-- Wait until NPC folder exists
local npcRoot = workspace:WaitForChild("__Main"):WaitForChild("__Enemies"):WaitForChild("Client")

-- Scan NPCs before building dropdown
local npcList = {}
local npcMap = {}

local function scanNPCs()
    npcList = {}
    npcMap = {}
    for _, npc in pairs(npcRoot:GetChildren()) do
        local displayName = npc.Name
        if npc:FindFirstChild("Humanoid") and npc.Humanoid.DisplayName then
            displayName = npc.Humanoid.DisplayName
        elseif npc:FindFirstChild("Head") and npc.Head:FindFirstChild("NameTag") then
            displayName = npc.Head.NameTag.Text
        elseif npc:FindFirstChild("DisplayName") then
            displayName = npc.DisplayName.Value
        elseif npc:GetAttribute("DisplayName") then
            displayName = npc:GetAttribute("DisplayName")
        end

        if not npcMap[displayName] then
            table.insert(npcList, displayName)
            npcMap[displayName] = npc.Name
        end
    end

    if #npcList == 0 then
        table.insert(npcList, "No NPCs Found")
    end
end

scanNPCs() -- important: scan before UI creation

-- Create UI
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Arise Crossover - Rimuru Hub",
    LoadingTitle = "Predator Mode Activated",
    LoadingSubtitle = "by Rimuru ðŸ˜ˆ",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "AriseCrossoverHub",
        FileName = "Config"
    }
})

local FarmTab = Window:CreateTab("Auto Farm", 4483362458)

local selectedNPC = npcList[1] or ""
local autofarm = false

-- Dropdown for NPC selection
FarmTab:CreateDropdown({
    Name = "Select NPC",
    Options = npcList,
    CurrentOption = selectedNPC,
    Flag = "NPCDropdown",
    Callback = function(option)
        selectedNPC = option
    end,
})

-- Toggle Auto Farm
FarmTab:CreateToggle({
    Name = "Auto Farm NPC",
    CurrentValue = false,
    Flag = "AutoFarmToggle",
    Callback = function(Value)
        autofarm = Value
        game.Players.LocalPlayer:SetAttribute("AutoClick", Value)

        if autofarm then
            task.spawn(function()
                while autofarm do
                    local npcFound = nil

                    for _, npc in pairs(npcRoot:GetChildren()) do
                        local name = npc.Name
                        if npc:FindFirstChild("Humanoid") and npc.Humanoid.DisplayName then
                            name = npc.Humanoid.DisplayName
                        elseif npc:FindFirstChild("Head") and npc.Head:FindFirstChild("NameTag") then
                            name = npc.Head.NameTag.Text
                        elseif npc:FindFirstChild("DisplayName") then
                            name = npc.DisplayName.Value
                        elseif npc:GetAttribute("DisplayName") then
                            name = npc:GetAttribute("DisplayName")
                        end

                        if name == selectedNPC then
                            npcFound = npc
                            break
                        end
                    end

                    local char = game.Players.LocalPlayer.Character
                    if npcFound and npcFound:FindFirstChild("Hitbox") and char and char:FindFirstChild("HumanoidRootPart") then
                        char:MoveTo(npcFound.Hitbox.Position + Vector3.new(0, 3, 0))
                    end

                    task.wait(0.3)
                end
            end)
        end
    end,
})
